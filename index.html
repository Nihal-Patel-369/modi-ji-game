<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="manifest" href="manifest.webmanifest"> 

    <meta name="theme-color" content="#2c3e50"> 
    
    <title>Modi Ji Flappy Bird Game - Uddta Hi Phirun - High Score Challenge!</title>
    <meta name="description" content="Modi Ji Flappy Bird ‡§ú‡•à‡§∏‡§æ ‡§Æ‡§ú‡§º‡•á‡§¶‡§æ‡§∞ ‡§ó‡•á‡§Æ ‡§ñ‡•á‡§≤‡•á‡§Ç! '‡§â‡§°‡§º‡§§‡§æ ‡§π‡•Ä ‡§´‡§ø‡§∞‡•Ç‡§Å ‡§á‡§® ‡§π‡§µ‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§ï‡§π‡•Ä‡§Ç...' ‡§ó‡§æ‡§®‡•á ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡§ú‡§º‡•á‡§¶‡§æ‡§∞ ‡§™‡§æ‡§á‡§™‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç‡•§ ‡§Ö‡§™‡§®‡•á ‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§π‡§æ‡§à ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§ï‡§æ ‡§ö‡•à‡§≤‡•á‡§Ç‡§ú ‡§¶‡•á‡§Ç!">
    <meta name="keywords" content="Modi Flappy Game, Modi Flying Game, PM Modi Game, Uddta HiPhirun, Fun Games, Viral Game, Timepass, Political Satire">
    <meta property="og:title" content="Modi Ji Flappy Game - Uddta Hi Phirun - High Score Challenge!">
    <meta property="og:description" content="‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§ñ‡•á‡§≤‡•ã ‡§î‡§∞ ‡§¶‡•á‡§ñ‡•ã ‡§Ü‡§™ ‡§ï‡§ø‡§§‡§®‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§ï‡§∞ ‡§™‡§æ‡§§‡•á ‡§π‡•ã! Game Over ‡§™‡§∞ '‡§≤‡•å**‡•á ‡§≤‡§ó ‡§ó‡§è' ‡§∏‡§æ‡§â‡§Ç‡§° ‡§Ü‡§è‡§ó‡§æ‡•§">
    <meta property="og:image" content="https://‡§Ü‡§™‡§ï‡§æ-netlify-‡§≤‡§ø‡§Ç‡§ï/social_share.png"> 
    <meta property="og:url" content="https://‡§Ü‡§™‡§ï‡§æ-netlify-‡§≤‡§ø‡§Ç‡§ï">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Viral Modi Flappy Game!">
    <meta name="twitter:description" content="‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ 50 ‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§™‡§æ‡§∞ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç? Tap ‡§ï‡§∞‡§ï‡•á PM Modi ‡§ï‡•ã ‡§â‡§°‡§º‡§æ‡§è‡§Ç!">
    <meta name="twitter:image" content="https://‡§Ü‡§™‡§ï‡§æ-netlify-‡§≤‡§ø‡§Ç‡§ï/social_share.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        body {
            margin: 0; padding: 0; background-color: #2c3e50; font-family: 'Press Start 2P', cursive;
            overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; touch-action: none; 
        }

        #gameContainer {
            position: relative; width: 100%; max-width: 480px; height: 100vh; max-height: 800px;
            background-color: #70c5ce; box-shadow: 0 0 30px rgba(0,0,0,0.5); overflow: hidden;
        }

        canvas { display: block; width: 100%; height: 100%; }

        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; z-index: 50; 
        }

        #scoreBoard {
            position: absolute; top: 10%; width: 100%; text-align: center; font-size: 40px;
            color: white; text-shadow: 3px 3px 0 #000; z-index: 100;
        }

        #startScreen, #gameOverScreen, #settingsPanel {
            background: rgba(0, 0, 0, 0.7); pointer-events: auto; border-radius: 15px; padding: 20px;
            width: 80%; border: 4px solid #fff;
        }

        .hidden { display: none !important; }

        h1 { color: #f1c40f; font-size: 24px; line-height: 1.5; margin-bottom: 20px; text-shadow: 2px 2px #000; }
        p { color: #fff; font-size: 12px; line-height: 1.8; margin-bottom: 20px; }
        
        button {
            background: #e74c3c; color: white; border: 2px solid #c0392b; padding: 15px 30px;
            font-family: 'Press Start 2P', cursive; font-size: 16px; cursor: pointer; box-shadow: 0 4px #992d22;
            transition: transform 0.1s; margin-top: 10px;
        }
        button:active { transform: translateY(4px); box-shadow: 0 0 #992d22; }

        /* Settings specific styles */
        #settingsBtn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #3498db; 
            border: 2px solid #2980b9;
            width: 50px;
            height: 50px;
            padding: 0;
            box-shadow: 0 4px #2980b9;
            font-size: 20px;
            line-height: 40px;
            z-index: 60; 
        }

        #settingsPanel p { margin: 10px 0; font-size: 14px; }
        
        #jumpSlider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: #ccc;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        #jumpSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%; 
            background: #e74c3c;
            cursor: pointer;
        }
        
        .footer { position: absolute; bottom: 10px; font-size: 10px; color: rgba(255,255,255,0.5); pointer-events: auto; }
        .social-share { margin-top: 15px; display: flex; gap: 10px; }
        .social-share a { color: white; text-decoration: none; font-size: 10px; padding: 5px 10px; border-radius: 5px; background-color: #2ecc71; box-shadow: 0 2px #27ae60; }
        #installBtn { background-color: #3498db; border-color: #2980b9; box-shadow: 0 4px #2980b9; margin-top: 20px; }
        #installBtn:active { box-shadow: 0 0 #2980b9; }

    </style>
</head>
<body>

    <img id="modiImg" src="modi.png" style="display:none;">
    <audio id="bgMusic" src="bg_music.mp3" loop></audio>
    <audio id="dieSound" src="gameover.mp3"></audio>

    <div id="gameContainer">
        <canvas id="canvas"></canvas>

        <div id="scoreBoard">0</div>

        <button id="settingsBtn" class="hidden"><i class="fas fa-cog"></i></button>

        <div id="startScreen" class="overlay">
            <h1>MODI JI<br>KI UDAAN</h1>
            <p>‡§Æ‡§ø‡§§‡•ç‡§∞‡•ã‡§Ç! ‡§â‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è<br>Tap ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ Space ‡§¶‡§¨‡§æ‡§è‡§Ç</p>
            <button id="startBtn">START GAME</button>
            
            <button id="installBtn" class="hidden">DOWNLOAD APP (Install)</button> 
            
            <div class="footer">Made for Fun</div>
        </div>

        <div id="settingsPanel" class="overlay hidden">
            <h1>SETTINGS</h1>
            
            <p>JUMP POWER (‡§õ‡§≤‡§æ‡§Ç‡§ó ‡§∂‡§ï‡•ç‡§§‡§ø):</p>
            <input type="range" min="3.0" max="6.0" value="4.0" step="0.1" id="jumpSlider">
            <p>Value: <span id="jumpValue">4.0</span></p>

            <p>Default Jump (4.0) Recommended for Mobile</p>
            
            <button id="settingsBackBtn" style="background: #2ecc71; border-color: #27ae60; box-shadow: 0 4px #27ae60;">BACK</button>
        </div>


        <div id="gameOverScreen" class="overlay hidden">
            <h1 style="color: #e74c3c;">GAME OVER</h1>
            <p>‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: <span id="finalScore">0</span><br>‡§¨‡•á‡§∏‡•ç‡§ü ‡§∏‡•ç‡§ï‡•ã‡§∞: <span id="bestScore">0</span></p>
            <button id="restartBtn">RETRY</button>
            
            <div class="social-share">
                <a id="whatsappShare" href="#" target="_blank">Share WhatsApp</a>
                <a id="twitterShare" href="#" target="_blank">Share Twitter</a>
            </div>
        </div>
    </div>

<script>
    // ----------------------------------------------------------------------
    // PWA & Service Worker Code (Registration)
    // ----------------------------------------------------------------------

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js', {scope: './'})
                .then(registration => { console.log('SW registered:', registration); })
                .catch(error => { console.error('SW registration failed:', error); });
        });
    }

    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.classList.remove('hidden');
    });

    installBtn.addEventListener('click', (e) => {
        installBtn.classList.add('hidden');
        if (deferredPrompt) {
             deferredPrompt.prompt();
             deferredPrompt.userChoice.then((choiceResult) => {
                 if (choiceResult.outcome === 'accepted') { console.log('User accepted the A2HS prompt'); } 
                 else { console.log('User dismissed the A2HS prompt'); }
                 deferredPrompt = null;
             });
        }
    });

    // ----------------------------------------------------------------------
    // Game Logic Setup
    // ----------------------------------------------------------------------
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // UI Elements
    const scoreElement = document.getElementById('scoreBoard');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const settingsPanel = document.getElementById('settingsPanel');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsBackBtn = document.getElementById('settingsBackBtn');
    const jumpSlider = document.getElementById('jumpSlider');
    const jumpValueEl = document.getElementById('jumpValue');
    const restartBtn = document.getElementById('restartBtn');
    const startBtn = document.getElementById('startBtn'); 

    // ‚úÖ FIX 1: Defining all Game Over Screen elements here
    const finalScoreEl = document.getElementById('finalScore');
    const bestScoreEl = document.getElementById('bestScore');
    const whatsappShareBtn = document.getElementById('whatsappShare');
    const twitterShareBtn = document.getElementById('twitterShare');


    const modiSprite = document.getElementById('modiImg');
    const bgMusic = document.getElementById('bgMusic');
    const dieSound = document.getElementById('dieSound');

    let gamePlaying = false;
    let score = 0;
    let animationId;
    let savedHighScore = localStorage.getItem('modiGameHighScore') || 0;
    let currentJumpPower = parseFloat(localStorage.getItem('modiJumpPower')) || 4.0; 
    
    const cWidth = 320; 
    const cHeight = 480;
    canvas.width = cWidth;
    canvas.height = cHeight;
    const GAME_URL = window.location.href; 

    // --- OBJECTS ---
    const bird = {
        x: 50, y: 150, w: 34, h: 24, dy: 0, 
        gravity: 0.18, 
        jump: currentJumpPower, 
        draw: function() {
            if (modiSprite.complete && modiSprite.naturalHeight !== 0) {
                ctx.save();
                ctx.translate(this.x + this.w/2, this.y + this.h/2);
                let rotation = Math.min(Math.PI / 4, Math.max(-Math.PI / 4, (this.dy * 0.1)));
                ctx.rotate(rotation);
                ctx.drawImage(modiSprite, -this.w/2, -this.h/2, this.w, this.h);
                ctx.restore();
            } else {
                ctx.fillStyle = "yellow";
                ctx.fillRect(this.x, this.y, this.w, this.h);
            }
        },
        update: function() {
            this.dy += this.gravity;
            this.y += this.dy;
            if (this.y + this.h >= cHeight - fg.h) {
                this.y = cHeight - fg.h - this.h;
                gameOver();
            }
            if(this.y < 0) this.y = 0;
        },
        flap: function() { this.dy = -this.jump; }
    };

    const pipes = {
        items: [], w: 52, 
        gap: 130, 
        dx: 1.8,  
        draw: function() {
            for(let i=0; i<this.items.length; i++) {
                let p = this.items[i];
                ctx.fillStyle = "#2ecc71";
                ctx.strokeStyle = "#27ae60";
                ctx.lineWidth = 2;
                ctx.fillRect(p.x, 0, this.w, p.top);
                ctx.strokeRect(p.x, 0, this.w, p.top);
                let bottomY = p.top + this.gap;
                ctx.fillRect(p.x, bottomY, this.w, cHeight - bottomY - fg.h);
                ctx.strokeRect(p.x, bottomY, this.w, cHeight - bottomY - fg.h);
            }
        },
        update: function() {
            if(frames % 130 === 0) { 
                let _maxY = cHeight - fg.h - this.gap - 20; 
                let _top = Math.random() * (_maxY - 20) + 20;
                this.items.push({ x: cWidth, top: _top, passed: false });
            }
            for(let i=0; i<this.items.length; i++) {
                let p = this.items[i];
                p.x -= this.dx;
                if(bird.x + bird.w > p.x && bird.x < p.x + this.w) {
                    if(bird.y < p.top || bird.y + bird.h > p.top + this.gap) {
                        gameOver();
                    }
                }
                // Scoring fix
                if(p.x + this.w <= bird.x && !p.passed) { 
                    score++;
                    scoreElement.innerText = score;
                    p.passed = true;
                }
                // Pipe removal fix
                if(p.x + this.w <= 0) { 
                    this.items.shift();
                    i--;
                }
            }
        }
    };

    const fg = {
        h: 80, x: 0,
        draw: function() {
            ctx.fillStyle = "#e67e22";
            ctx.fillRect(this.x, cHeight - this.h, cWidth, this.h);
            ctx.fillRect(this.x + cWidth, cHeight - this.h, cWidth, this.h);
            ctx.fillStyle = "#27ae60";
            ctx.fillRect(this.x, cHeight - this.h, cWidth, 15);
            ctx.fillRect(this.x + cWidth, cHeight - this.h, cWidth, 15);
        },
        update: function() {
            this.x = (this.x - 2) % (cWidth);
        }
    };

    // --- GAME LOOP / CONTROL FUNCTIONS ---
    let frames = 0;
    function loop() {
        if(!gamePlaying) return;
        ctx.fillStyle = "#70c5ce";
        ctx.fillRect(0, 0, cWidth, cHeight);
        pipes.update();
        pipes.draw();
        fg.update();
        fg.draw();
        bird.update();
        bird.draw();
        frames++;
        animationId = requestAnimationFrame(loop);
    }

    function initGame() {
        bird.jump = currentJumpPower; 
        
        bird.y = 150; bird.dy = 0; pipes.items = []; score = 0; frames = 0;
        scoreElement.innerText = 0;
        gamePlaying = true;
        
        startScreen.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
        settingsPanel.classList.add('hidden');
        settingsBtn.classList.add('hidden'); 
        
        bgMusic.currentTime = 0;
        bgMusic.play().catch(e => console.log("Audio play failed on start:", e));
        loop();
    }

    function gameOver() {
        gamePlaying = false;
        cancelAnimationFrame(animationId);
        bgMusic.pause();
        dieSound.play();

        if(score > savedHighScore) {
            savedHighScore = score;
            localStorage.setItem('modiGameHighScore', savedHighScore);
        }

        // Use the defined elements to update the screen
        finalScoreEl.innerText = score; 
        bestScoreEl.innerText = savedHighScore;
        updateShareLinks(score);
        
        // This is the core line to show the game over screen
        gameOverScreen.classList.remove('hidden'); 
        settingsBtn.classList.remove('hidden'); 
    }
    
    function updateShareLinks(currentScore) {
        const shareText = `‡§Æ‡•à‡§Ç‡§®‡•á Modi Ji Flappy Game ‡§Æ‡•á‡§Ç ${currentScore} ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§ï‡§ø‡§Ø‡§æ! üöÄ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§Æ‡•Å‡§ù‡•á ‡§π‡§∞‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç?`;
        const whatsappLink = `whatsapp://send?text=${encodeURIComponent(shareText)}%20${encodeURIComponent(GAME_URL)}`;
        whatsappShareBtn.href = whatsappLink;
        const twitterLink = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(GAME_URL)}&hashtags=ModiGame,UddtaHiPhirun,Flappy`;
        twitterShareBtn.href = twitterLink;
    }

    // --- INPUT HANDLING (FIXED BUG) ---
    function inputAction(e) {
        // Prevent click/tap from acting as an input if it hits any UI element
        if(e.target.tagName === 'BUTTON' || e.target.closest('.overlay')) {
             return;
        }

        if(!gamePlaying && !startScreen.classList.contains('hidden')) {
            initGame();
        } else if(gamePlaying) {
            bird.flap();
        } else if(!gamePlaying && !gameOverScreen.classList.contains('hidden')) {
            initGame();
        }
    }

    // --- SETTINGS CONTROLS ---

    function showStartScreen() {
        settingsPanel.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
        settingsBtn.classList.remove('hidden');
        startScreen.classList.remove('hidden');
    }
    
    function showSettingsPanel() {
        startScreen.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
        settingsBtn.classList.add('hidden');
        settingsPanel.classList.remove('hidden');
        
        jumpSlider.value = currentJumpPower.toFixed(1);
        jumpValueEl.innerText = currentJumpPower.toFixed(1);
    }

    // Event Listeners (BUTTONS)
    
    startBtn.addEventListener('click', initGame);
    restartBtn.addEventListener('click', initGame);

    settingsBtn.addEventListener('click', function(e) {
        e.stopPropagation(); 
        showSettingsPanel();
    });
    
    settingsBackBtn.addEventListener('click', function(e) {
        e.stopPropagation(); 
        showStartScreen();
    });
    
    jumpSlider.addEventListener('input', function() {
        currentJumpPower = parseFloat(this.value);
        jumpValueEl.innerText = currentJumpPower.toFixed(1);
        localStorage.setItem('modiJumpPower', currentJumpPower.toFixed(1)); 
    });


    // Event Listeners (CANVAS/WINDOW)
    window.addEventListener('mousedown', inputAction);
    window.addEventListener('touchstart', (e) => {
       inputAction(e);
    }, {passive: true}); 

    window.addEventListener('keydown', (e) => {
        if(e.code === 'Space') {
            inputAction(e);
        }
    });
    
    // Initial State
    showStartScreen(); 

    // Initial Draw
    ctx.fillStyle = "#70c5ce";
    ctx.fillRect(0, 0, cWidth, cHeight);
    fg.draw();
    bird.draw();
    
</script>
</body>
</html>
